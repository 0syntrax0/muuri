/*!
 * Muuri v0.3.0-dev
 * https://github.com/haltu/muuri
 * Copyright (c) 2015, Haltu Oy
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(t,e){var i,n,o="Muuri";if("function"==typeof define&&define.amd)define(function(r){return i=r.defined&&r.defined("velocity")?r("velocity"):void 0,n=r.defined&&r.defined("hammer")?r("hammer"):void 0,e(t,o,i,n)});else if("object"==typeof module&&module.exports){try{i=require("velocity-animate")}catch(r){}try{n=require("hammerjs")}catch(r){}module.exports=e(t,o,i,n)}else i="function"==typeof t.jQuery?t.jQuery.Velocity:t.Velocity,n=t.Hammer,t[o]=e(t,o,i,n)}(this,function(t,e,n,o,r){"use strict";function s(e){var i,n=this,o=n._settings=C(s.defaultSettings,e);if(!document.body.contains(o.container))throw new Error("Container must be an existing DOM element");n._element=o.container,I(o.container,o.containerClass),n._id=++F,n._layout=null,n._emitter=new s.Emitter,n._itemShowHandler="function"==typeof o.show?o.show():q("show",o.show),n._itemHideHandler="function"==typeof o.hide?o.hide():q("hide",o.hide),n.refresh(),n._items=Array.prototype.slice.call(o.items).map(function(t){return new s.Item(n,t)}),"number"!=typeof o.layoutOnResize&&o.layoutOnResize!==!0||(i=R(function(){n.refresh().refreshItems().layoutItems()},Math.max(0,parseInt(o.layoutOnResize)||0)),n._resizeHandler=function(){i()},t.addEventListener("resize",n._resizeHandler)),o.layoutOnInit&&n.layoutItems(!0)}function l(t,e){var i,n,o=this,r=t._settings;if(e.contains(t._element))throw new Error("Item element must be within the grid container element");e.parentNode!==t._element&&t._element.appendChild(e),I(e,r.itemClass),n="none"===S(e,"display"),I(e,n?r.itemHiddenClass:r.itemVisibleClass),o._id=++F,o._muuri=t,o._element=e,o._child=e.children[0],o._animate=new s.AnimateLayout(o,e),o._animateChild=new s.AnimateVisibility(o,o._child),o._isDefaultAnimate=o._animate instanceof d,o._isDefaultChildAnimate=o._animateChild instanceof d,o._isActive=!n,o._isPositioning=!1,o._isHidden=n,o._isHiding=!1,o._isShowing=!1,o._visibilityQueue=[],o._layoutQueue=[],o._left=0,o._top=0,i={left:"0",top:"0",transform:"translateX(0px) translateY(0px)"},n||(i.display="block"),x(o._element,i),o._refresh(),n?t._itemHideHandler.start(o,!0):t._itemShowHandler.start(o,!0),o._drag=r.dragEnabled?new s.Drag(o):null}function a(t,e){var i=this,n=t._settings.layout,o=t._padding,r=t._border;i.muuri=t,i.items=e?e.concat():t.getItems("active"),i.slots={},i.setWidth=!1,i.setHeight=!1,i.width=t._width-r.left-r.right-o.left-o.right,i.height=t._height-r.top-r.bottom-o.top-o.bottom,"function"==typeof n?n(i):u(i,y(n)?n:{})}function u(t,e){var i,n,o,r,s=[],l=!!e.fillGaps,a=!!e.horizontal,h=!!e.alignRight,d=!!e.alignBottom;if(a?(t.setWidth=!0,t.width=0):(t.setHeight=!0,t.height=0),t.items.length){for(r=0;r<t.items.length;r++)o=t.items[r],n=u.getSlot(t,s,o._outerWidth,o._outerHeight,!a,l),a?t.width=Math.max(t.width,n.left+n.width):t.height=Math.max(t.height,n.top+n.height),t.slots[o._id]=n;if(h||d)for(i=Object.keys(t.slots),r=0;r<i.length;r++)n=t.slots[i[r]],h&&(n.left=t.width-(n.left+n.width)),d&&(n.top=t.height-(n.top+n.height))}}function h(){}function d(t,i){this._element=i,this._queue=e+"-"+ ++F,this._isAnimating=!1}function f(t){if(!o)throw Error("["+e+"] required dependency Hammer is not defined.");var i,n=this,r=t._muuri._settings,s="function"==typeof r.dragStartPredicate?r.dragStartPredicate:f.defaultStartPredicate,l=null,a=null;n._item=t,n._hammer=i=new o.Manager(t._element),n._setupDragData(),n._setupReleaseData(),n._checkSortOverlap=R(function(){n._drag.isActive&&n._checkOverlap()},r.dragSortInterval),n._sortPredicate="function"==typeof r.dragSortPredicate?r.dragSortPredicate:f.defaultSortPredicate,n._scrollHandler=function(t){n._onDragScroll(t)},i.add(new o.Pan({event:"drag",pointers:1,threshold:0,direction:o.DIRECTION_ALL})),i.add(new o.Press({event:"draginit",pointers:1,threshold:1e3,time:0})),i.set({touchAction:"none"}),i.on("draginit dragstart dragmove",function(e){a=e,l||(l=new m(function(){l===this&&n._onDragStart(a)})),l._isResolved&&n._drag.isActive?n._onDragMove(e):l._isRejected||l._isResolved||s.call(t._muuri,t,e,l)}).on("dragend dragcancel draginitup",function(e){l._isResolved&&n._drag.isActive&&n._onDragEnd(e),s.call(t._muuri,t,e,l),l.reject(),l=null,a=null}),Q(t._element),Q(t._child)}function m(t,e){this._isResolved=!1,this._isRejected=!1,this._onResolved=t,this._onRejected=e}function _(t,e){var i=t.length,n=i-1;return e>n?n:e<0?Math.max(i+e,0):e}function c(t,e,i){if(!(t.length<2)){var n,o=_(t,e),r=_(t,i);o!==r&&(n=t[o],t[o]=t[r],t[r]=n)}}function p(t,e,i){if(!(t.length<2)){var n=_(t,e),o=_(t,i);n!==o&&t.splice(o,0,t.splice(n,1)[0])}}function g(t){var e,i=[],n=t.length;if(n)for(i[0]=t[0],e=1;e<n;e++)i.indexOf(t[e])<0&&(i[i.length]=t[e]);return i}function y(t){return"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)}function v(t){var e=Object.prototype.toString.call(t);return"[object HTMLCollection]"===e||"[object NodeList]"===e}function w(t,e){return Object.keys(e).forEach(function(i){var n=y(e[i]);y(t[i])&&n?(t[i]=w({},t[i]),t[i]=w(t[i],e[i])):t[i]=n?w({},e[i]):Array.isArray(e[i])?e[i].slice(0):e[i]}),t}function b(t){var e={};return Object.keys(t).forEach(function(i){var n=t[i];n!==r&&null!==n&&(e[i]=n)}),e}function C(t,e){var i=w({},t);return i=e?w(i,e):i,i.show&&i.show.styles&&(i.show.styles=b(i.show.styles)),i.hide&&i.hide.styles&&(i.hide.styles=b(i.hide.styles)),i}function D(t,e,i){var n="number"==typeof i?i:-1;t.splice.apply(t,[n<0?t.length-n+1:n,0].concat(e))}function R(e,i){var n,o="cancel",s="finish";return i>0?function(l){n!==r&&(n=t.clearTimeout(n),l===s&&e()),l!==o&&l!==s&&(n=t.setTimeout(function(){n=r,e()},i))}:function(t){t!==o&&e()}}function S(e,i){return t.getComputedStyle(e,null).getPropertyValue("transform"===i?G.styleName||i:i)}function A(t,e){return parseFloat(S(t,e))||0}function H(t,e){return parseFloat((S(t,"transform")||"").replace("matrix(","").split(",")["x"===e?4:5])||0}function x(t,e){var i,n,o,r=Object.keys(e);for(o=0;o<r.length;o++)i=r[o],n=e[i],"transform"===i&&G&&(i=G.propName),t.style[i]=n}function E(t,e){var i,o=Object.keys(e);for(i=0;i<o.length;i++)n.hook(t,o[i],e[o[i]])}function P(t,e){return(t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector).call(t,"."+e)}function I(t,e){t.classList?t.classList.add(e):P(t,e)&&(t.className+=" "+e)}function O(t,e){t.classList?t.classList.remove(e):P(t,e)&&(t.className=(" "+t.className+" ").replace(" "+e+" "," ").trim())}function L(t){var e,i,n,o=document.documentElement,s=t.charAt(0).toUpperCase()+t.slice(1),l=["","Webkit","Moz","O","ms"];for(n=0;n<l.length;n++)if(e=l[n],i=e?e+s:t,o.style[i]!==r)return e=e.toLowerCase(),{prefix:e,propName:i,styleName:e?"-"+e+"-"+t:t};return null}function j(t,e){var i,n,o=k(t)||document,r={left:0,top:0};return o===e?r:(i=N(o,"padding"),n=N(e,"padding"),{left:n.left-i.left,top:n.top-i.top})}function M(e){var i=[],n=/(auto|scroll)/,o=e.parentNode;if(U){if("fixed"===S(e,"position"))return i;for(;o&&o!==document&&o!==document.documentElement;)n.test(S(o,"overflow")+S(o,"overflow-y")+S(o,"overflow-x"))&&(i[i.length]=o),o="fixed"===S(o,"position")?null:o.parentNode;null!==o&&(i[i.length]=t)}else{for(;o&&o!==document;)"fixed"!==S(e,"position")||Y(o)?(n.test(S(o,"overflow")+S(o,"overflow-y")+S(o,"overflow-x"))&&(i[i.length]=o),e=o,o=o.parentNode):o=o.parentNode;i.length&&i[i.length-1]===document.documentElement&&(i[i.length-1]=t)}return i}function X(){if(!G)return!0;var t,e,i=document.createElement("div"),n=document.createElement("div");return x(i,{display:"block",visibility:"hidden",position:"absolute",width:"1px",height:"1px",left:"1px",top:"0",margin:"0",transform:"none"}),x(n,{display:"block",position:"fixed",width:"1px",height:"1px",left:"0",top:"0",margin:"0",transform:"none"}),i.appendChild(n),document.body.appendChild(i),t=n.getBoundingClientRect().left,i.style[G.propName]="scaleX(1)",e=n.getBoundingClientRect().left,document.body.removeChild(i),e===t}function Y(t){var e=S(t,"transform"),i=S(t,"display");return"none"!==e&&"inline"!==i&&"none"!==i}function k(e){if(e===document)return null;if(e===t)return document;var i=S(e,"position");if("relative"===i)return e;if("fixed"!==i&&"absolute"!==i)return null;if("fixed"===i&&U)return t;var n=e===document.documentElement?document:e.parentElement||null;if("fixed"===i){for(;n&&n!==document&&!Y(n);)n=n.parentElement||document;return n===document?t:n}for(;n&&n!==document&&"static"===S(n,"position")&&!Y(n);)n=n.parentElement||document;return n}function N(e,i){var n={left:0,top:0};if(e===document)return n;if(n.left=t.pageXOffset||0,n.top=t.pageYOffset||0,e.self===t.self)return n;var o=e.getBoundingClientRect();if(n.left+=o.left,n.top+=o.top,i=i||"border","margin"===i){var r=A(e,"margin-left"),s=A(e,"margin-top");n.left-=r>0?r:0,n.top-=s>0?s:0}else"border"!==i&&(n.left+=A(e,"border-left-width"),n.top+=A(e,"border-top-width"));return"content"===i&&(n.left+=A(e,"padding-left"),n.top+=A(e,"padding-top")),n}function Q(t){var e=t.tagName.toLowerCase();"a"!==e&&"img"!==e||t.addEventListener("dragstart",T,!1)}function z(t){var e=t.tagName.toLowerCase();"a"!==e&&"img"!==e||t.removeEventListener("dragstart",T,!1)}function V(t,e,i,n,o){var r,s,l,a,u=t.getItems(i),h="function"==typeof n?n:o,d=u.length,f="show"===e,m=f?et:nt,_=f?it:ot,c=n===!0,p=!1;if(d){for(r=[],s=[],t._emitter.emit(m,u),a=0;a<u.length;a++)l=u[a],(f&&!l._isActive||!f&&l._isActive)&&(p=!0,f&&(l._noLayoutAnimation=!0,s[s.length]=l)),l["_"+e](c,function(e,i){e||(r[r.length]=i),--d<1&&("function"==typeof h&&h(r),t._emitter.emit(_,r))});p&&(s.length&&t.refreshItems(s),t.layoutItems())}else"function"==typeof o&&o(u)}function q(t,e){var i=parseInt(e&&e.duration)||0,n=i>0,o=e&&e.easing||"ease",r=e&&y(e.styles)?e.styles:null;return{start:function(t,e,s){var l;n&&r?e?(t._isDefaultChildAnimate?E(t._child,r):x(t._child,r),s&&s()):(l={duration:i,easing:o,done:s},t._isDefaultChildAnimate?t._animateChild.start(null,r,l):t._animateChild.start(r,l)):s&&s()},stop:function(t){t._animateChild.stop()}}}function B(t,e,i){var n,o=t.splice(0,t.length);for(n=0;n<o.length;n++)o[n](e,i)}function W(t,e){if(t.left+t.width<=e.left||e.left+e.width<=t.left||t.top+t.height<=e.top||e.top+e.height<=t.top)return 0;var i=Math.min(t.left+t.width,e.left+e.width)-Math.max(t.left,e.left),n=Math.min(t.top+t.height,e.top+e.height)-Math.max(t.top,e.top),o=Math.min(t.width,e.width),r=Math.min(t.height,e.height);return i*n/(o*r)*100}function T(t){t.preventDefault&&t.preventDefault()}var F=0,G=L("transform"),U=X(),J="refresh",K="refreshitems",Z="synchronizeitems",$="layoutitemsstart",tt="layoutitemsend",et="showitemsstart",it="showitemsend",nt="hideitemsstart",ot="hideitemsend",rt="moveitem",st="senditem",lt="receiveitem",at="additems",ut="removeitems",ht="dragitemstart",dt="dragitemmove",ft="dragitemscroll",mt="dragitemend",_t="releaseitemstart",ct="releaseitemend",pt="destroy";return s.Item=l,s.Drag=f,s.Layout=a,s.AnimateLayout=d,s.AnimateVisibility=d,s.Emitter=h,s.defaultSettings={container:null,items:[],show:{duration:300,easing:"ease",styles:{opacity:1,scale:1}},hide:{duration:300,easing:"ease",styles:{opacity:0,scale:.5}},layout:{fillGaps:!1,horizontal:!1,alignRight:!1,alignBottom:!1},layoutOnResize:100,layoutOnInit:!0,layoutDuration:300,layoutEasing:"ease",dragEnabled:!1,dragContainer:null,dragStartPredicate:null,dragSort:!0,dragSortInterval:50,dragSortPredicate:{threshold:50,action:"move"},dragReleaseDuration:300,dragReleaseEasing:"ease",containerClass:"muuri",itemClass:"muuri-item",itemVisibleClass:"muuri-item-shown",itemHiddenClass:"muuri-item-hidden",itemPositioningClass:"muuri-item-positioning",itemDraggingClass:"muuri-item-dragging",itemReleasingClass:"muuri-item-releasing"},s.prototype.getElement=function(){return this._element},s.prototype.getRect=function(){return{width:this._width,height:this._height,left:this._offset.left,right:this._offset.left+this._width,top:this._offset.top,bottom:this._offset.top+this._height}},s.prototype.getItems=function(t,e){var i,n,o,r,s=this,l=t&&"string"!=typeof t,a=l?v(t)?Array.prototype.slice.call(t):[].concat(t):null,u=l?e:t,h=[];if(u="string"==typeof u?u:null,u||a){for(a=a||s._items,i="active"===u,n="inactive"===u,r=0;r<a.length;r++)o=l?s._getItem(a[r]):a[r],o&&(!u||i&&o._isActive||n&&!o._isActive)&&(h[h.length]=o);return h}return h.concat(s._items)},s.prototype.on=function(t,e){return this._emitter.on(t,e),this},s.prototype.off=function(t,e){return this._emitter.off(t,e),this},s.prototype.refresh=function(){var t,e,i=this,n=i._element,o=["left","right","top","bottom"],r=n.getBoundingClientRect();for(i._offset=i._offset||{},i._border=i._border||{},i._padding=i._padding||{},i._width=Math.round(r.width),i._height=Math.round(r.height),i._offset.left=Math.round(r.left),i._offset.top=Math.round(r.top),e=0;e<o.length;e++)t=o[e],i._border[t]=Math.round(A(n,"border-"+t+"-width")),i._padding[t]=Math.round(A(n,"padding-"+t));return i._emitter.emit(J),i},s.prototype.refreshItems=function(t){var e,i=this,n=i.getItems(t||"active");for(e=0;e<n.length;e++)n[e]._refresh();return i._emitter.emit(K,n),i},s.prototype.addItems=function(t,e){var i,n,o,r=this,l=[].concat(t),a=[],u=r._items,h=!1;for(o=0;o<u.length;o++)i=l.indexOf(u[o]._element),i>-1&&l.splice(i,1);if(!l.length)return a;for(o=0;o<l.length;o++)n=new s.Item(r,l[o]),a[a.length]=n,n._isActive&&(h=!0,n._noLayoutAnimation=!0);return D(u,a,e),h&&r.layoutItems(),r._emitter.emit(at,a),a},s.prototype.removeItems=function(t,e){var i,n,o=this,r=o.getItems(t),s=[],l=!1;for(n=0;n<r.length;n++)i=r[n],i._isActive&&(l=!0),s[s.length]=i._destroy(e);return l&&o.layoutItems(),o._emitter.emit(ut,s),s},s.prototype.synchronizeItems=function(){var t,e,i,n=this,o=n._element,r=n._items;if(r.length){for(i=0;i<r.length;i++)e=r[i]._element,e.parentNode===o&&(t=t||document.createDocumentFragment(),t.appendChild(e));t&&o.appendChild(t)}return n._emitter.emit(Z),n},s.prototype.layoutItems=function(t,e){function i(t,e){t||(_[_.length]=e),++f===m&&("function"==typeof u&&u(_),a.emit(tt,_))}var n,o,r,l=this,a=l._emitter,u="function"==typeof t?t:e,h=t===!0,d=new s.Layout(l),f=0,m=d.items.length,_=[];if(l._layout=d,a.emit($,d.items),d.setHeight&&(x(l._element,{height:d.height+"px"}),l._height=d.height),d.setWidth&&(x(l._element,{width:d.width+"px"}),l._width=d.width),m)for(r=0;r<d.items.length;r++)n=d.items[r],o=d.slots[n._id],n._left=o.left+l._padding.left,n._top=o.top+l._padding.top,n._drag&&n._drag._drag.isActive?i(!1,n):n._layout(h,i);else i(!0);return l},s.prototype.showItems=function(t,e,i){return V(this,"show",t,e,i),this},s.prototype.hideItems=function(t,e,i){return V(this,"hide",t,e,i),this},s.prototype.moveItem=function(t,e,i){var n,o,r,s=this,l=s._items;return l.length<2?s:(n=s._getItem(t),o=s._getItem(e),r="swap"===i,n&&o&&n!==o&&(r?c(l,l.indexOf(n),l.indexOf(o)):p(l,l.indexOf(n),l.indexOf(o)),s.layoutItems()._emitter.emit(rt,n,o,r?"swap":"move")),s)},s.prototype.sendItem=function(t){var e,i,n=this,o=n._settings,r=t.target,l=r._settings,a=n._getItem(t.item),u=!!t.instant,h=t.layoutContainer||document.body,f=t.position,m=a._element,_=a.isVisible(),c=n._items.indexOf(a),p="number"==typeof f?f:f?r._items.indexOf(r._getItem(f)):0,g={left:0,top:0};return a._stopLayout(!0),n._itemShowHandler.stop(a),n._itemHideHandler.stop(a),a._drag.destroy(),a._animate.destroy(),a._animateChild.destroy(),B(a._visibilityQueue,!0,a),O(m,o.itemClass),O(m,o.itemVisibleClass),O(m,o.itemHiddenClass),I(m,l.itemClass),I(m,_?l.itemVisibleClass:l.itemHiddenClass),n._items.splice(c,1),D(r._items,a,p),a._muuri=r,e=H(m,"x"),i=H(m,"y"),m.parentNode!==h&&(g=j(m,h),h.appendChild(m)),m.removeAttribute("style"),x(n._element,{transform:"translateX("+(e-g.left)+"px) translateY("+(i-g.top)+"px)"}),a._animate=new s.AnimateLayout(a,m),a._animateChild=new s.AnimateVisibility(a,a._child),a._isDefaultAnimate=a._animate instanceof d,a._isDefaultChildAnimate=a._animateChild instanceof d,_?r._itemShowHandler.start(a,!0):r._itemHideHandler.start(a,!0),_&&a._refresh(),a._drag=l.dragEnabled?new s.Drag(a):null,n.layoutItems(u),r.layoutItems(u),n._emitter.emit(st,a,r,p),r._emitter.emit(lt,a,n,p),currentMuuri},s.prototype.destroy=function(){var e,i,n=this,o=n._element,r=n._items.concat(),l=n._emitter,a=Object.keys(n).concat(Object.keys(s.prototype));for(n._resizeHandler&&t.removeEventListener("resize",n._resizeHandler),i=0;i<r.length;i++)r[i]._destroy();for(O(o,n._settings.containerClass),x(o,{height:""}),l.emit(pt),e=Object.keys(l._events||{}),i=0;i<e.length;i++)l._events[e[i]].length=0;for(i=0;i<a.length;i++)n[a[i]]=null},s.prototype._getItem=function(t){var e,i,n,o,r=this;if(t){if(t instanceof l)return t._muuri===r?t:null;if("number"==typeof t)return e=t>-1?t:r._items.length+t,r._items[e]||null;for(i=null,o=0;o<r._items.length;o++)if(n=r._items[o],n._element===t){i=n;break}return i}return r._items[0]||null},l.prototype.getElement=function(){return this._element},l.prototype.getWidth=function(){return this._width},l.prototype.getHeight=function(){return this._height},l.prototype.getMargin=function(){return{left:this._margin.left,right:this._margin.right,top:this._margin.top,bottom:this._margin.bottom}},l.prototype.getPosition=function(){return{left:this._left,top:this._top}},l.prototype.isActive=function(){return this._isActive},l.prototype.isVisible=function(){return!this._isHidden},l.prototype.isShowing=function(){return this._isShowing},l.prototype.isHiding=function(){return this._isHiding},l.prototype.isPositioning=function(){return this._isPositioning},l.prototype.isDragging=function(){return this._drag&&this._drag._drag.isActive},l.prototype.isReleasing=function(){return this._drag&&this._drag._release.isActive},l.prototype._stopLayout=function(t){var e=this,i=e._muuri._settings;return e._isPositioning&&(e._animate.stop(),O(e._element,i.itemPositioningClass),e._isPositioning=!1,t&&B(e._layoutQueue,!0,e)),e},l.prototype._refresh=function(){var t,e,i,n,o,r=this,s=r._element;if(!r._isHidden){for(e=["left","right","top","bottom"],n=r._margin=r._margin||{},o=0;o<4;o++)i=Math.round(A(s,"margin-"+e[o])),n[e[o]]=i>0?i:0;t=s.getBoundingClientRect(),r._width=Math.round(t.width),r._height=Math.round(t.height),r._outerWidth=r._width+n.left+n.right,r._outerHeight=r._height+n.top+n.bottom}return r},l.prototype._layout=function(t,e){var i,o,r,s,l=this,a=l._muuri._settings,u=l._drag?l._drag._release:{},h=u.isActive&&u.isPositioningStarted===!1,d=h?a.dragReleaseDuration:a.layoutDuration,f=h?a.dragReleaseEasing:a.layoutEasing,m=t!==!0&&!l._noLayoutAnimation&&d>0,_=l._isPositioning,c=function(){l._isPositioning&&(l._isPositioning=!1,O(l._element,a.itemPositioningClass)),u.isActive&&l._drag._endRelease(),B(l._layoutQueue,!1,l)};if(_&&B(l._layoutQueue,!0,l),h&&(u.isPositioningStarted=!0),"function"==typeof e&&(l._layoutQueue[l._layoutQueue.length]=e),i=u.isActive?u.containerDiffX:0,o=u.isActive?u.containerDiffY:0,m){if(_&&l._isDefaultAnimate?(r=parseFloat(n.hook(l._element,"translateX"))-i,s=parseFloat(n.hook(l._element,"translateY"))-o):(r=H(l._element,"x")-i,s=H(l._element,"y")-o),l._left===r&&l._top===s)return l._stopLayout(),void c();_||(l._isPositioning=!0,I(l._element,a.itemPositioningClass)),l._animate.start({translateX:(u.isActive?r+i:r)+"px",translateY:(u.isActive?s+o:s)+"px"},{translateX:l._left+i,translateY:l._top+o},{duration:d,easing:f,done:c})}else l._stopLayout(),l._noLayoutAnimation=!1,u.isActive&&u.element.parentNode!==l._muuri._element||x(l._element,{transform:"translateX("+(l._left+i)+"px) translateY("+(l._top+o)+"px)"}),c();return l},l.prototype._show=function(t,e){var i=this,n=i._muuri._settings;return i._isHidden||i._isShowing?i._isHidden?(i._isHiding&&i._muuri._itemHideHandler.stop(i),i._isActive=i._isShowing=!0,i._isHidden=i._isHiding=!1,I(i._element,n.itemVisibleClass),O(i._element,n.itemHiddenClass),x(i._element,{display:"block"}),B(i._visibilityQueue,!0,i),"function"==typeof e&&(i._visibilityQueue[i._visibilityQueue.length]=e),i._muuri._itemShowHandler.start(i,t,function(){B(i._visibilityQueue,!1,i)})):"function"==typeof e&&(i._visibilityQueue[i._visibilityQueue.length]=e):"function"==typeof e&&e(!1,i),i},l.prototype._hide=function(t,e){var i=this,n=i._muuri._settings;return i._isHidden&&!i._isHiding?"function"==typeof e&&e(!1,i):i._isHidden?"function"==typeof e&&(i._visibilityQueue[i._visibilityQueue.length]=e):(i._isShowing&&i._muuri._itemShowHandler.stop(i),i._isHidden=i._isHiding=!0,i._isActive=i._isShowing=!1,I(i._element,n.itemHiddenClass),O(i._element,n.itemVisibleClass),B(i._visibilityQueue,!0,i),"function"==typeof e&&(i._visibilityQueue[i._visibilityQueue.length]=e),i._muuri._itemHideHandler.start(i,t,function(){x(i._element,{display:"none"}),B(i._visibilityQueue,!1,i)})),i},l.prototype._destroy=function(t){var e,i=this,n=i._muuri,o=n._settings,r=i._element,s=n._items.indexOf(i),a=Object.keys(i).concat(Object.keys(l.prototype));for(i._stopLayout(!0),n._itemShowHandler.stop(i),n._itemHideHandler.stop(i),i._drag&&i._drag.destroy(),i._animate.destroy(),i._animateChild.destroy(),r.removeAttribute("style"),i._child.removeAttribute("style"),B(i._visibilityQueue,!0,i),O(r,o.itemPositioningClass),O(r,o.itemDraggingClass),O(r,o.itemReleasingClass),O(r,o.itemClass),O(r,o.itemVisibleClass),O(r,o.itemHiddenClass),s>-1&&n._items.splice(s,1),t&&r.parentNode.removeChild(r),e=0;e<a.length;e++)i[a[e]]=null},u.getSlot=function(t,e,i,n,o,r){var s,l,a,h,d,f=e[0]||[],m=[],_={left:null,top:null,width:i,height:n};for(h=0;h<f.length;h++)if(s=f[h],_.width<=s.width&&_.height<=s.height){_.left=s.left,_.top=s.top;break}for(null===_.left&&(_.left=o?0:t.width,_.top=o?t.height:0,r||(a=!0)),o&&_.top+_.height>t.height&&(_.left>0&&(m[m.length]={left:0,top:t.height,width:_.left,height:1/0}),_.left+_.width<t.width&&(m[m.length]={left:_.left+_.width,top:t.height,width:t.width-_.left-_.width,height:1/0}),t.height=_.top+_.height),!o&&_.left+_.width>t.width&&(_.top>0&&(m[m.length]={left:t.width,top:0,width:1/0,height:_.top}),_.top+_.height<t.height&&(m[m.length]={left:t.width,top:_.top+_.height,width:1/0,height:t.height-_.top-_.height}),t.width=_.left+_.width),h=r?0:a?f.length:h;h<f.length;h++)for(l=u.splitRect(f[h],_),d=0;d<l.length;d++)s=l[d],s.width>0&&s.height>0&&(o&&s.top<t.height||!o&&s.left<t.width)&&(m[m.length]=s);return u.purgeSlots(m).sort(o?u.sortRectsTopLeft:u.sortRectsLeftTop),e[0]=m,_},u.sortRectsTopLeft=function(t,e){return t.top<e.top?-1:t.top>e.top?1:t.left<e.left?-1:t.left>e.left?1:0},u.sortRectsLeftTop=function(t,e){return t.left<e.left?-1:t.left>e.left?1:t.top<e.top?-1:t.top>e.top?1:0},u.isRectWithinRect=function(t,e){return t.left>=e.left&&t.top>=e.top&&t.left+t.width<=e.left+e.width&&t.top+t.height<=e.top+e.height},u.purgeSlots=function(t){for(var e,i,n,o=t.length;o--;)for(i=t[o],e=t.length;e--;)if(n=t[e],o!==e&&u.isRectWithinRect(i,n)){t.splice(o,1);break}return t},u.splitRect=function(t,e){var i=[],n=!(e.left>t.left+t.width||e.left+e.width<t.left||e.top>t.top+t.height||e.top+e.height<t.top);return n?(t.left<e.left&&(i[i.length]={left:t.left,top:t.top,width:e.left-t.left,height:t.height}),t.left+t.width>e.left+e.width&&(i[i.length]={left:e.left+e.width,top:t.top,width:t.left+t.width-(e.left+e.width),height:t.height}),t.top<e.top&&(i[i.length]={left:t.left,top:t.top,width:t.width,height:e.top-t.top}),t.top+t.height>e.top+e.height&&(i[i.length]={left:t.left,top:e.top+e.height,width:t.width,height:t.top+t.height-(e.top+e.height)})):i[0]=t,i},h.prototype.on=function(t,e){var i=this._events=this._events||{},n=i[t]||[];return n[n.length]=e,i[t]=n,this},h.prototype.off=function(t,e){var n=this._events=this._events||{},o=n[t]||[],r=o.length;if(r)for(;r--;)e===o[i]&&o.splice(r,1);return this},h.prototype.emit=function(t,e,i,n){var o,r,s=this._events=this._events||{},l=s[t]||[],a=l.length;if(a)for(o=arguments.length-1,l=l.concat(),r=0;r<a;r++)0===o?l[r]():1===o?l[r](e):2===o?l[r](e,i):l[r](e,i,n);return this},d.prototype.start=function(t,e,i){var o=this,r=i||{},s="function"==typeof r.done?r.done:null,l={duration:r.duration||300,delay:r.delay||0,easing:r.easing||"ease",queue:o._queue};o._isAnimating&&o.stop(),t&&E(o._element,t),o._isAnimating=!0,s&&(l.complete=function(){s()}),n(o._element,e,l),n.Utilities.dequeue(o._element,o._queue)},d.prototype.stop=function(){this._isAnimating&&(this._isAnimating=!1,n(this._element,"stop",this._queue))},d.prototype.destroy=function(){this.stop(),this._element=null,this._isAnimating=null,this._queue=null},f.defaultStartPredicate=function(t,e,i){i.resolve()},f.defaultSortPredicate=function(t){var e,i,n,o,r=t._muuri,s=r._settings,l=s.dragSortPredicate||{},a=l.threshold||50,u=l.action||"move",h=r._items,d=t._drag,f={width:d._item._width,height:d._item._height,left:Math.round(d._drag.gridX)+d._item._margin.left,top:Math.round(d._drag.gridY)+d._item._margin.top},m=0,_=null;for(o=0;o<h.length;o++)n=h[o],n===t?m=o:n._isActive&&(i=W(f,{width:n._width,height:n._height,left:Math.round(n._left)+n._margin.left,top:Math.round(n._top)+n._margin.top}),(null===_||i>_)&&(_=i,e=o));return null!==_&&_>=a&&{action:u,from:m,to:e}},f.prototype.destroy=function(){var t=this,e=t._item,i=e._muuri,n=t._drag,o=t._release;return(o.isActive||n.isActive)&&e._element.parentNode!==i._element&&i._element.appendChild(e._element),t._setupReleaseData(),t._resetDrag(),z(e._element),z(e._child),t},f.prototype._setupDragData=function(){var t=this._drag=this._drag||{};return t.isActive=!1,t.startEvent=null,t.currentEvent=null,t.elementStyles=null,t.scrollParents=[],t.left=0,t.top=0,t.gridX=0,t.gridY=0,t.elementClientX=0,t.elementClientY=0,t.containerDiffX=0,t.containerDiffY=0,t},f.prototype._setupReleaseData=function(){var t=this._release=this._release||{};return t.isActive=!1,t.isPositioningStarted=!1,t.containerDiffX=0,t.containerDiffY=0,t.element=null,t.elementStyles=null,t},f.prototype._checkOverlap=function(){var t=this,e=t._sortPredicate(t._item);e&&t._item._muuri.moveItem(e.from,e.to,e.action||"move")},f.prototype._freezeElement=function(t){var e,i,n;if(!t.elementStyles)for(e=["width","height","padding","margin"],t.elementStyles={},n=0;n<4;n++)i=e[n],t.elementStyles[i]=t.element.style[i]||"",t.element.style[i]=S(t.element,i)},f.prototype._unfreezeElement=function(t){var e,i,n;if(t.elementStyles){for(e=Object.keys(t.elementStyles),n=0;n<e.length;n++)i=e[n],t.element.style[i]=t.elementStyles[i];t.elementStyles=null}},f.prototype._resetDrag=function(){var t,e=this,i=e._item,n=e._drag,o=i._muuri._settings;if(n.isActive){for(t=0;t<n.scrollParents.length;t++)n.scrollParents[t].removeEventListener("scroll",e._scrollHandler);e._checkSortOverlap("cancel"),O(n.element,o.itemDraggingClass),e._unfreezeElement(n),e._setupDragData()}},f.prototype._startRelease=function(){var t=this,e=t._item,i=e._muuri,n=i._settings,o=t._release;o.isActive=!0,I(o.element,n.itemReleasingClass),i._emitter.emit(_t,e),e._layout(!1)},f.prototype._endRelease=function(){var t=this,e=t._item,i=e._muuri,n=i._settings,o=t._release;O(o.element,n.itemReleasingClass),o.element.parentNode!==i._element&&(i._element.appendChild(o.element),x(e._element,{transform:"translateX("+e._left+"px) translateY("+e._top+"px)"})),t._unfreezeElement(o),t._setupReleaseData(),i._emitter.emit(ct,e)},f.prototype._onDragStart=function(t){var e,i,n,o,r,s,l,a=this,u=a._item,h=u._muuri,d=h._settings,f=a._drag,m=a._release;if(u._isActive){for(u._isPositioning&&u._stopLayout(!0),m.isActive&&(f.elementStyles=m.elementStyles,O(u._element,d.itemReleasingClass),a._setupReleaseData()),f.isActive=!0,f.startEvent=t,f.currentEvent=t,f.element=u._element,e=H(f.element,"x"),i=H(f.element,"y"),n=h._element,o=d.dragContainer,f.left=f.gridX=e,f.top=f.gridY=i,o&&o!==n&&(f.element.parentNode===o?(r=j(f.element,n),f.containerDiffX=r.left,f.containerDiffY=r.top,f.gridX=e-f.containerDiffX,f.gridY=i-f.containerDiffY):(a._freezeElement(f),o.appendChild(f.element),r=j(f.element,n),f.containerDiffX=r.left,f.containerDiffY=r.top,f.left=e+f.containerDiffX,f.top=i+f.containerDiffY,x(f.element,{transform:"translateX("+f.left+"px) translateY("+f.top+"px)"}))),s=f.element.getBoundingClientRect(),f.elementClientX=s.left,f.elementClientY=s.top,f.scrollParents=M(f.element),o&&o!==n&&(f.scrollParents=g(f.scrollParents.concat(M(n)))),l=0;l<f.scrollParents.length;l++)f.scrollParents[l].addEventListener("scroll",a._scrollHandler);I(f.element,d.itemDraggingClass),h._emitter.emit(ht,u,t)}},f.prototype._onDragMove=function(t){var e,i,n=this,o=n._item,r=o._muuri,s=r._settings,l=n._drag;return o._isActive?(e=t.deltaX-l.currentEvent.deltaX,i=t.deltaY-l.currentEvent.deltaY,l.currentEvent=t,l.left+=e,l.top+=i,l.gridX+=e,l.gridY+=i,l.elementClientX+=e,l.elementClientY+=i,x(l.element,{transform:"translateX("+l.left+"px) translateY("+l.top+"px)"}),s.dragSort&&n._checkSortOverlap(),void r._emitter.emit(dt,o,t)):void n._resetDrag()},f.prototype._onDragScroll=function(){var t,e=this,i=e._item,n=i._muuri,o=n._settings,r=e._drag,s=n._element,l=o.dragContainer,a=r.element.getBoundingClientRect(),u=r.elementClientX-a.left,h=r.elementClientY-a.top;l&&l!==s&&(t=j(r.element,s),r.containerDiffX=t.left,r.containerDiffY=t.top),r.left+=u,r.top+=h,r.gridX=r.left-r.containerDiffX,r.gridY=r.top-r.containerDiffY,x(r.element,{transform:"translateX("+r.left+"px) translateY("+r.top+"px)"}),o.dragSort&&e._checkSortOverlap(),n._emitter.emit(ft,i)},f.prototype._onDragEnd=function(t){var e,i=this,n=i._item,o=n._muuri,r=o._settings,s=i._drag,l=i._release;if(!n._isActive)return void i._resetDrag();for(r.dragSort&&i._checkSortOverlap("finish"),e=0;e<s.scrollParents.length;e++)s.scrollParents[e].removeEventListener("scroll",i._scrollHandler);O(s.element,r.itemDraggingClass),o._emitter.emit(mt,n,t),l.containerDiffX=s.containerDiffX,l.containerDiffY=s.containerDiffY,l.element=s.element,l.elementStyles=s.elementStyles,i._setupDragData(),i._startRelease()},m.prototype.isResolved=function(){return this._isResolved},m.prototype.isRejected=function(){return this._isRejected},m.prototype.resolve=function(){this._isRejected||this._isResolved||(this._isResolved=!0,"function"==typeof this._onResolved&&this._onResolved.call(this),this._onResolved=this._onRejected=null)},m.prototype.reject=function(){this._isRejected||this._isResolved||(this._isRejected=!0,"function"==typeof this._onRejected&&this._onRejected.call(this),this._onResolved=this._onRejected=null)},s});