/*!
 * Muuri v0.2.0-dev
 * https://github.com/haltu/muuri
 * Copyright (c) 2015, Haltu Oy
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(t,e){var i="Muuri",n="function"==typeof jQuery?jQuery.Velocity:t.Velocity,r=t.Hammer;t[i]=e(t,n,r)}(this,function(t,e,n,r){"use strict";function o(){}function s(e){var i=this,n=i._settings=f({},s.defaultSettings,e||{});if(!document.body.contains(n.container))throw new Error("Container must be an existing DOM element");i._element=n.container,v(n.container,n.containerClass),i._id=++N,i._animQueue="muuri-"+i._id,i._emitter=new o,i._itemShow="function"==typeof n.show?n.show():R(n.show,!0),i._itemHide="function"==typeof n.hide?n.hide():R(n.hide),i._items=[];for(var r=0,a=n.items.length;r<a;r++)i._items[i._items.length]=new s.Item(i,n.items[r]);if(n.layoutOnResize||0===n.layoutOnResize){var h=m(function(){i.refresh(),i.layout()},n.layoutOnResize);i._resizeHandler=function(){h()},t.addEventListener("resize",i._resizeHandler)}n.layoutOnInit&&i.layout(!0)}function a(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function h(t,e,i){t.splice(i,0,t.splice(e,1)[0])}function l(t){for(var e=[],i=0,n=t.length;i<n;i++)e.indexOf(t[i])===-1&&(e[e.length]=t[i]);return e}function u(t){return"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)}function f(t){for(var e=Array.prototype.slice.call(arguments,1),i=0;i<e.length;i++){var n=e[i];for(var r in n)n.hasOwnProperty(r)&&(u(t[r])&&u(n[r])?f(t[r],n[r]):t[r]=n[r])}return t}function m(e,i){var n,o="cancel",s="finish";return function(a){n!==r&&(n=t.clearTimeout(n),a===s&&e()),a!==o&&a!==s&&(n=t.setTimeout(function(){n=r,e()},i))}}function d(t,e){var i=null,n={left:t.left-e.left,right:e.left+e.width-(t.left+t.width),top:t.top-e.top,bottom:e.top+e.height-(t.top+t.height)},r=Math.max(t.width+Math.min(n.left,0)+Math.min(n.right,0),0),o=Math.max(t.height+Math.min(n.top,0)+Math.min(n.bottom,0),0),s=r>0&&o>0;return s&&(i={},i.width=r,i.height=o,i.left=t.left+Math.abs(Math.min(n.left,0)),i.right=i.left+i.width,i.top=t.top+Math.abs(Math.min(n.top,0)),i.bottom=i.top+i.height),i}function _(e,i){return t.getComputedStyle(e,null).getPropertyValue(i)}function g(t,e){for(var i in e)t.style[i]=e[i]}function c(t,i){for(var n in i)e.hook(t,n,i[n])}function p(t,e){return(" "+t.className).indexOf(" "+e)>-1}function v(t,e){t.classList?t.classList.add(e):p(t,e)&&(t.className+=" "+e)}function y(t,e){t.classList?t.classList.remove(e):p(t,e)&&(t.className=(" "+t.className+" ").replace(" "+e+" "," ").trim())}function w(e,i,n){var o=e.getBoundingClientRect()[i],s="height"===i,a=s?"Height":"Width",h="inner"+a,l="client"+a,u=s?"top":"left",f=s?"bottom":"right";if(n){var m=parseFloat(_(e,"margin-"+u)),d=parseFloat(_(e,"margin-"+f));o+=m>0?m:0,o+=d>0?d:0}else{var g,c;e===document.documentElement?o-=t[h]-document.documentElement[l]:(g=parseFloat(_(e,"border-"+u+"-width")),c=parseFloat(_(e,"border-"+f+"-width")),o-=Math.round(o)-e[l]-g-c),o-=g!==r?g:parseFloat(_(e,"border-"+u+"-width")),o-=c!==r?c:parseFloat(_(e,"border-"+f+"-width"))}return o}function b(e){var i=0,n=0,r=parseFloat(t.pageXOffset),o=parseFloat(t.pageYOffset);if(e.self===t.self)i=r,n=o;else if(e!==document){var s=e.getBoundingClientRect();i+=s.left+r+parseFloat(_(e,"border-left-width")),n+=s.top+o+parseFloat(_(e,"border-top-width"))}return{left:i,top:n}}function C(e){var i="fixed"===_(e,"position");if(i&&ht)return t;var n=e===document.documentElement||e===t?document:e.parentElement||null;if(i){for(;n&&n!==document&&!D(n);)n=n.parentElement||document;return n===document?t:n}for(;n&&n!==document&&"static"===_(n,"position")&&!D(n);)n=n.parentElement||document;return n}function D(t){var e=_(t,at),i=_(t,"display");return"none"!==e&&"inline"!==i&&"none"!==i}function x(t,e){var i=b(e),n=b(C(t)||doc);return n.left-=Math.abs(Math.min(parseFloat(_(t,"margin-left")),0)),n.top-=Math.abs(Math.min(parseFloat(_(t,"margin-top")),0)),{left:i.left-n.left,top:i.top-n.top}}function S(e){var i=[],n=/(auto|scroll)/,r=e.parentNode;if(ht){if("fixed"===_(e,"position"))return i;for(;r&&r!==document&&r!==document.documentElement;)n.test(_(r,"overflow")+_(r,"overflow-y")+_(r,"overflow-x"))&&(i[i.length]=r),r="fixed"===_(r,"position")?null:r.parentNode;null!==r&&(i[i.length]=t)}else{for(;r&&r!==document;)"fixed"!==_(e,"position")||D(r)?(n.test(_(r,"overflow")+_(r,"overflow-y")+_(r,"overflow-x"))&&(i[i.length]=r),e=r,r=r.parentNode):r=r.parentNode;i.length&&i[i.length-1]===document.documentElement&&(i[i.length-1]=t)}return i}function O(t,e){var i=d(t,e);if(!i)return 0;var n={width:t.width,height:t.height,left:0,top:0},r={width:e.width,height:e.height,left:0,top:0},o=d(n,r);return i.width*i.height/(o.width*o.height)*100}function I(t,e,i){return{type:t,event:e,currentLeft:i.left,currentTop:i.top,gridLeft:i.gridX,gridTop:i.gridY}}function X(t,e,i){this.isResolved||(this.isResolved=!0,i(t))}function Y(t){if(!t.elementStyles){var e=["width","height","padding","margin"];t.elementStyles={};for(var i=0;i<4;i++){var n=e[i],r=t.element.style[n];t.elementStyles[n]=r||""}for(var i=0;i<4;i++){var n=e[i];t.element.style[n]=_(t.element,n)}}}function E(t){if(t.elementStyles)for(var e in t.elementStyles)t.element.style[e]=t.elementStyles[e]}function L(t,e,i,n,r){i=t.get(i),r="function"==typeof n?n:r;var o=i.length;if(o){var s="show"===e,a=s?q:U,h=s?V:Z,l=n===!0,u=[],f=!1,m=[];t._emitter.emit(a,i);for(var d=0,_=i.length;d<_;d++){var g=i[d];(s&&!g._active||!s&&g._active)&&(f=!0,s&&(g._noLayoutAnimation=!0,m[m.length]=g)),g["_"+e](l,function(e,i){e||(u[u.length]=i),--o<1&&("function"==typeof r&&r(u),t._emitter.emit(h,u))})}f&&(m.length&&t.refresh(m),t.layout())}else"function"==typeof r&&r(i)}function R(t,i){var n=t&&t.duration||0,r=t&&t.easing||"ease-out";if(n){var o=i?{opacity:1,scale:1}:{opacity:0,scale:.5};return{start:function(t,i,s){i?c(t._child,o):(e(t._child,o,{duration:n,easing:r,queue:t._muuri._animQueue,complete:s}),e.Utilities.dequeue(t._child,t._muuri._animQueue))},stop:function(t){e(t._child,"stop",t._muuri._animQueue)}}}return{start:z,stop:z}}function M(t,e,i){for(var n=t.splice(0,t.length),r=0,o=n.length;r<o;r++)n[r](e,i)}function Q(t,e){return t.top<e.top?-1:t.top>e.top?1:t.left<e.left?-1:t.left>e.left?1:0}function k(t,e){return t.left<e.left?-1:t.left>e.left?1:t.top<e.top?-1:t.top>e.top?1:0}function F(t,e){return t.left>=e.left&&t.top>=e.top&&t.left+t.width<=e.left+e.width&&t.top+t.height<=e.top+e.height}function P(t){for(var e=t.length;e--;)for(var i=t[e],n=t.length;n--;){var r=t[n];if(e!==n&&F(i,r)){t.splice(e,1);break}}return t}function H(t,e){var i=[],n=!(e.left>t.left+t.width||e.left+e.width<t.left||e.top>t.top+t.height||e.top+e.height<t.top);return n?(t.left<e.left&&(i[i.length]={left:t.left,top:t.top,width:e.left-t.left,height:t.height}),t.left+t.width>e.left+e.width&&(i[i.length]={left:e.left+e.width,top:t.top,width:t.left+t.width-(e.left+e.width),height:t.height}),t.top<e.top&&(i[i.length]={left:t.left,top:t.top,width:t.width,height:e.top-t.top}),t.top+t.height>e.top+e.height&&(i[i.length]={left:t.left,top:e.top+e.height,width:t.width,height:t.top+t.height-(e.top+e.height)})):i[0]=t,i}var N=0,z=function(){},A="function"==typeof t.requestAnimationFrame?t.requestAnimationFrame:null,j="refresh",T="synchronize",B="layoutstart",W="layoutend",q="showstart",V="showend",U="hidestart",Z="hideend",G="move",J="swap",K="add",$="remove",tt="dragstart",et="dragmove",it="dragscroll",nt="dragend",rt="releasestart",ot="releaseend",st="destroy",at=function(){for(var t=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],e=0;e<t.length;e++)if(document.documentElement.style[t[e]]!==r)return t[e];return null}(),ht=function(){if(!document.body)throw Error("Muuri needs access to document.body to work.");if(!at)return!0;var t,e,i=document.body,n=document.createElement("div"),r=document.createElement("div");return g(n,{display:"block",visibility:"hidden",position:"absolute",width:"1px",height:"1px",left:"1px",top:"0",margin:"0"}),g(r,{display:"block",position:"fixed",width:"1px",height:"1px",left:"0",top:"0",margin:"0"}),n.appendChild(r),i.appendChild(n),t=r.getBoundingClientRect().left,n.style[at]="translateZ(0)",e=r.getBoundingClientRect().left,i.removeChild(n),e===t}();return o.prototype.on=function(t,e){var i=this._events=this._events||{},n=i[t]||[];return n[n.length]=e,i[t]=n,this},o.prototype.off=function(t,e){var n=this._events=this._events||{},r=n[t]||[],o=r.length;if(o)for(;o--;)e===r[i]&&r.splice(o,1);return this},o.prototype.emit=function(t,e,i,n){var r=this._events=this._events||{},o=r[t]||[],s=o.length;if(s){var a=arguments.length-1;o=o.concat();for(var h=0;h<s;h++)0===a?o[h]():1===a?o[h](e):2===a?o[h](e,i):o[h](e,i,n)}return this},s.prototype._getItem=function(t){if(t){if(t instanceof s.Item)return t._muuri===this?t:null;if("number"==typeof t)return t=t>-1?t:this._items.length+t,this._items[t]||null;for(var e=null,i=0,n=this._items.length;i<n;i++){var r=this._items[i];if(r._element===t){e=r;break}}return e}return this._items[0]||null},s.prototype.on=function(t,e){return this._emitter.on(t,e),this},s.prototype.off=function(t,e){return this._emitter.off(t,e),this},s.prototype.refresh=function(t){t=t?this.get(t):this.get("active");for(var e=0,i=t.length;e<i;e++)t[e]._refresh();this._emitter.emit(j,t)},s.prototype.get=function(t,e){var i=t&&"string"!=typeof t;if(e=i?e:t,e="string"==typeof e?e:null,t=i?[].concat(t):null,e||t){for(var n=t||this._items,r=[],o="active"===e,s="inactive"===e,a=0,h=n.length;a<h;a++){var l=i?this._getItem(n[a]):n[a];l&&(!e||o&&l._active||s&&!l._active)&&(r[r.length]=l)}return r}return this._items.concat()},s.prototype.add=function(t,e){var i=[],n=!1;t=[].concat(t);for(var r=0,o=this._items.length;r<o;r++){var a=this._items[r],e=t.indexOf(a._element);e>-1&&t.splice(e,1)}if(!t.length)return i;for(var r=0,o=t.length;r<o;r++){var a=new s.Item(this,t[r]);i[i.length]=a,a._active&&(n=!0,a._noLayoutAnimation=!0)}return e=e<0?this._items.length-e+1:e,this._items.splice.apply(this._items,[e,0].concat(i)),n&&this.layout(),this._emitter.emit(K,i),i},s.prototype.remove=function(t,e){var i=[],n=!1;t=this.get(t);for(var r=0,o=t.length;r<o;r++){var s=t[r];s._active&&(n=!0),i[i.length]=s._destroy(e)}return n&&this.layout(),this._emitter.emit($,i),i},s.prototype.synchronize=function(){for(var t=0,e=this._items.length;t<e;t++){var i=this._items[t];i._element.parentNode===this._element&&this._element.appendChild(i._element)}this._emitter.emit(T)},s.prototype.layout=function(t,e){var i=this,n=i._emitter,e="function"==typeof t?t:e,r=t===!0,o=new s.Layout(i),a=-1,h=o.items.length,l=[],u=function(t,i){t||(l[l.length]=i),++a===h&&("function"==typeof e&&e(l,o),n.emit(W,l,o))};if(n.emit(B,o.items,o),o.setHeight&&g(i._element,{height:o.height+"px"}),o.setWidth&&g(i._element,{width:o.width+"px"}),h)for(var f=0,m=o.items.length;f<m;f++){var d=o.items[f],_=o.slots[d._id];d._left=_.left,d._top=_.top,d._drag.active?u(!1,d):d._layout(r,u)}else u(!0)},s.prototype.show=function(t,e,i){L(this,"show",t,e,i)},s.prototype.hide=function(t,e,i){L(this,"hide",t,e,i)},s.prototype.indexOf=function(t){if("number"==typeof t)return t<=this._items.length-1?t:null;if(t instanceof s.Item){var e=this._items.indexOf(t);return e>-1?e:null}for(var e=null,i=0,n=this._items.length;i<n;i++)if(this._items[i]._element===t){e=i;break}return e},s.prototype.move=function(t,e){t=this._getItem(t),e=this._getItem(e),t&&e&&t!==e&&(h(this._items,this._items.indexOf(t),this._items.indexOf(e)),this._emitter.emit(G,t,e))},s.prototype.swap=function(t,e){t=this._getItem(t),e=this._getItem(e),t&&e&&t!==e&&(a(this._items,this._items.indexOf(t),this._items.indexOf(e)),this._emitter.emit(J,t,e))},s.prototype.destroy=function(){this._resizeHandler&&t.removeEventListener("resize",this._resizeHandler);for(var e=this._items.concat(),i=0,n=e.length;i<n;i++)e[i]._destroy();y(this._element,this._settings.containerClass),g(this._element,{height:""}),this._emitter.emit(st);var r=this._emitter._events;if(r)for(var o=Object.keys(this._emitter._events),i=0,n=o.length;i<n;i++)r[o[i]].length=0;for(var a=Object.keys(this).concat(Object.keys(s.prototype)),i=0;i<a.length;i++)this[a[i]]=null},s.Item=function(t,e){if(e.contains(t._element))throw new Error("Item element must not be a parent of the grid container element");e.parentNode!==t._element&&t._element.appendChild(e);var i=t._settings,n="none"===_(e,"display");this._id=++N,this._muuri=t,this._element=e,this._child=e.children[0],v(e,i.itemClass),this._active=!n,this._positioning=!1,this._hidden=n,this._hiding=!1,this._showing=!1,this._visibiliyQueue=[],this._layoutQueue=[],c(this._element,{left:"0",top:"0",translateX:"0px",translateY:"0px"}),v(e,n?i.hiddenClass:i.shownClass),c(this._child,{scale:n?0:1,opacity:n?0:1}),n||g(this._element,{display:"block"}),this._refresh(),this._left=0,this._top=0,this._drag={active:!1},this._release={active:!1},t._settings.dragEnabled&&this._initDrag()},s.Item.prototype.inspect=function(){return{element:this._element,width:this._width,height:this._height,left:this._left,top:this._top,active:this._active,positioning:this._positioning,dragging:this._drag.active,releasing:this._release.active,visibility:this._hiding?"hiding":this._showing?"showing":this._hidden?"hidden":"shown"}},s.Item.prototype._initDrag=function(){var t=this,e=t._muuri._settings,i=t._hammer=new n.Manager(t._element);i.add(new n.Pan({event:"drag",pointers:1,threshold:0,direction:n.DIRECTION_ALL})),i.add(new n.Press({event:"draginit",pointers:1,threshold:100,time:0})),i.set({touchAction:"none"}),t._resetReleaseData();var r=t._drag;t._resetDragData(),r.checkOverlap=m(function(){r.active&&t._checkOverlap()},e.dragSortInterval);var o=!1;r.predicate="function"==typeof e.dragPredicate?e.dragPredicate:X,r.predicateData={},r.isPredicateResolved=function(){return o},r.resolvePredicate=function(e){o||"draginitup"===e.type||"dragend"===e.type||"dragcancel"===e.type||(o=!0,t._onDragStart(e))},r.onScroll=function(e){A?A(function(){t._onDragScroll(e)}):t._onDragScroll(e)},i.on("draginit",function(e){r.predicateData={},o=!1,r.predicate.call(r.predicateData,e,t,r.resolvePredicate)}).on("dragstart dragmove",function(e){o&&r.active&&t._onDragMove(e),r.predicate.call(r.predicateData,e,t,r.resolvePredicate)}).on("dragend dragcancel draginitup",function(e){o&&r.active&&t._onDragEnd(e),r.predicate.call(r.predicateData,e,t,r.resolvePredicate)})},s.Item.prototype._resetDragData=function(){var t=this._drag;t.active=!1,t.start=null,t.move=null,t.element=null,t.elemWidth=0,t.elemHeight=0,t.elementStyles=null,t.scrollParents=[],t.left=0,t.top=0,t.gridX=0,t.gridY=0,t.elemClientX=0,t.elemClientY=0,t.containerDiffX=0,t.containerDiffY=0},s.Item.prototype._onDragStart=function(t){var i=this._drag,n=this._muuri._settings,r=this._release.active;if(this._active){this._positioning&&this._stopLayout(),r&&(i.elementStyles=this._release.elementStyles,y(this._element,n.releasingClass),this._resetReleaseData()),i.active=!0,i.start=t,i.move=t,i.element=this._element,i.elemWidth=this._width,i.elemHeight=this._height;var o=parseFloat(e.hook(i.element,"translateX"))||0,s=parseFloat(e.hook(i.element,"translateY"))||0,a=this._muuri._element,h=n.dragContainer;if(i.left=i.gridX=o,i.top=i.gridY=s,h&&h!==a)if(i.element.parentNode===h){var u=x(i.element,a);i.containerDiffX=u.left,i.containerDiffY=u.top,i.gridX=o-i.containerDiffX,i.gridY=s-i.containerDiffY}else{Y(i),h.appendChild(i.element);var u=x(i.element,a);i.containerDiffX=u.left,i.containerDiffY=u.top,i.left=o+i.containerDiffX,i.top=s+i.containerDiffY,c(i.element,{translateX:i.left+"px",translateY:i.top+"px"})}var f=i.element.getBoundingClientRect();i.elemClientX=f.left,i.elemClientY=f.top,i.scrollParents=S(i.element),h&&h!==a&&(i.scrollParents=l(i.scrollParents.concat(S(a))));for(var m=0,d=i.scrollParents.length;m<d;m++)i.scrollParents[m].addEventListener("scroll",i.onScroll);v(i.element,n.draggingClass),this._muuri._emitter.emit(tt,this,I("dragstart",t,i))}},s.Item.prototype._onDragMove=function(t){var e=this._drag,i=this._muuri._settings;if(!this._active)return void this._resetDrag();var n=t.deltaX-e.move.deltaX,r=t.deltaY-e.move.deltaY;e.move=t,e.left+=n,e.top+=r,e.gridX+=n,e.gridY+=r,e.elemClientX+=n,e.elemClientY+=r,c(e.element,{translateX:e.left+"px",translateY:e.top+"px"}),i.dragSort&&e.checkOverlap(),this._muuri._emitter.emit(et,this,I("dragmove",t,e))},s.Item.prototype._onDragScroll=function(t){var e=this._drag,i=this._muuri._settings,n=this._muuri._element,r=i.dragContainer,o=e.element.getBoundingClientRect(),s=e.elemClientX-o.left,a=e.elemClientY-o.top;if(r&&r!==n){var h=x(e.element,n);e.containerDiffX=h.left,e.containerDiffY=h.top}e.left+=s,e.top+=a,e.gridX=e.left-e.containerDiffX,e.gridY=e.top-e.containerDiffY,c(e.element,{translateX:e.left+"px",translateY:e.top+"px"}),i.dragSort&&e.checkOverlap(),this._muuri._emitter.emit(it,this,I("dragscroll",t,e))},s.Item.prototype._onDragEnd=function(t){var e=this._drag,i=this._muuri._settings,n=this._release;if(!this._active)return void this._resetDrag();i.dragSort&&e.checkOverlap("finish");for(var r=0,o=e.scrollParents.length;r<o;r++)e.scrollParents[r].removeEventListener("scroll",e.onScroll);y(e.element,i.draggingClass),e.active=!1,this._muuri._emitter.emit(nt,this,I("dragend",t,e)),n.containerDiffX=e.containerDiffX,n.containerDiffY=e.containerDiffY,n.element=e.element,n.elementStyles=e.elementStyles,this._resetDragData(),this._startRelease()},s.Item.prototype._resetDrag=function(t){for(var e=this._drag,i=this._muuri._settings,n=0,r=e.scrollParents.length;n<r;n++)e.scrollParents[n].removeEventListener("scroll",e.onScroll);e.checkOverlap("cancel"),y(e.element,i.draggingClass),E(e),this._resetDragData()},s.Item.prototype._resetReleaseData=function(){var t=this._release;t.active=!1,t.positioningStarted=!1,t.containerDiffX=0,t.containerDiffY=0,t.element=null,t.elementStyles=null},s.Item.prototype._startRelease=function(){var t=this._muuri._settings,e=this._release;e.active=!0,v(e.element,t.releasingClass),this._muuri._emitter.emit(rt,this),this._layout(!1)},s.Item.prototype._endRelease=function(){var t=this._muuri._settings,e=this._release;y(e.element,t.releasingClass),e.element.parentNode!==this._muuri._element&&(this._muuri._element.appendChild(e.element),c(e.element,{translateX:this._left+"px",translateY:this._top+"px"})),E(e),this._resetReleaseData(),this._muuri._emitter.emit(ot,this)},s.Item.prototype._checkOverlap=function(){for(var t=this._muuri._settings,e=t.dragSortTolerance,i=t.dragSortAction,n=this._muuri._items,r=null,o=0,s={width:this._drag.elemWidth,height:this._drag.elemHeight,left:this._drag.gridX,top:this._drag.gridY},l=0,u=n.length;l<u;l++){var f=n[l];if(f===this)o=l;else if(f._active){var m=O(s,{width:f._width,height:f._height,left:f._left,top:f._top});(!r||m>r.score)&&(r={item:f,score:m,index:l})}}r&&r.score>=e&&("swap"===i?(a(n,o,r.index),this._muuri._emitter.emit(J,this,r.item)):(h(n,o,r.index),this._muuri._emitter.emit(G,this,r.item)),this._muuri.layout())},s.Item.prototype._stopLayout=function(){var t=this._muuri._settings;this._positioning&&(e(this._element,"stop",this._muuri._animQueue),y(this._element,t.positioningClass),this._positioning=!1,M(this._layoutQueue,!0,this))},s.Item.prototype._refresh=function(){this._hidden||(this._width=Math.round(w(this._element,"width",!0)),this._height=Math.round(w(this._element,"height",!0)))},s.Item.prototype._layout=function(t,i){var n=this,r=n._muuri._settings,o=n._release,s=o.active&&o.positioningStarted===!1,a=s?r.dragReleaseDuration:r.positionDuration,h=s?r.dragReleaseEasing:r.positionEasing,l=t!==!0&&!n._noLayoutAnimation&&a>0,u=n._positioning,f=function(){y(n._element,r.positioningClass),n._positioning=!1,o.active&&n._endRelease(),M(n._layoutQueue,!1,n)};n._stopLayout(),"function"==typeof i&&(n._layoutQueue[n._layoutQueue.length]=i),s&&(o.positioningStarted=!0);var m=n._release.active?n._release.containerDiffX:0,d=n._release.active?n._release.containerDiffY:0;if(l){var _=(parseFloat(e.hook(n._element,"translateX"))||0)+m,g=(parseFloat(e.hook(n._element,"translateY"))||0)+d;if(n._left===_&&n._top===g)return void f();n._positioning=!0,u||v(n._element,r.positioningClass),e(n._element,{translateX:n._left+m,translateY:n._top+d},{duration:a,easing:h,complete:f,queue:n._muuri._animQueue}),e.Utilities.dequeue(n._element,n._muuri._animQueue)}else n._noLayoutAnimation&&(n._noLayoutAnimation=!1),c(n._element,{translateX:n._left+m+"px",translateY:n._top+d+"px"}),f()},s.Item.prototype._show=function(t,e){var i=this,n=i._muuri._settings;if(i._hidden||i._showing)if(i._hidden){i._hiding;i._muuri._itemHide.stop(i),i._active=!0,i._hidden=!1,i._showing=i._hiding=!1,v(i._element,n.shownClass),y(i._element,n.hiddenClass),g(i._element,{display:"block"}),M(i._visibiliyQueue,!0,i),i._showing=!0,"function"==typeof e&&(i._visibiliyQueue[i._visibiliyQueue.length]=e),i._muuri._itemShow.start(i,t,function(){M(i._visibiliyQueue,!1,i)})}else"function"==typeof e&&(i._visibiliyQueue[i._visibiliyQueue.length]=e);else"function"==typeof e&&e(!1,i)},s.Item.prototype._hide=function(t,e){var i=this,n=i._muuri._settings;if(i._hidden&&!i._hiding)"function"==typeof e&&e(!1,i);else if(i._hidden)"function"==typeof e&&(i._visibiliyQueue[i._visibiliyQueue.length]=e);else{i._showing;i._muuri._itemShow.stop(i),i._active=!1,i._hidden=!0,i._showing=i._hiding=!1,v(i._element,n.hiddenClass),y(i._element,n.shownClass),M(i._visibiliyQueue,!0,i),i._hiding=!0,"function"==typeof e&&(i._visibiliyQueue[i._visibiliyQueue.length]=e),i._muuri._itemHide.start(i,t,function(){g(i._element,{display:"none"}),M(i._visibiliyQueue,!1,i)})}},s.Item.prototype._destroy=function(t){var e=(this._muuri,this._muuri._settings),i=this._element,n=this._muuri._items.indexOf(this);this._stopLayout(),this._muuri._itemShow.stop(this),this._muuri._itemHide.stop(this),this._release.active&&(i.parentNode!==this._muuri._element&&this._muuri._element.appendChild(i),this._resetReleaseData()),this._drag.active&&(i.parentNode!==this._muuri._element&&this._muuri._element.appendChild(i),this._resetDrag()),this._hammer&&this._hammer.destroy(),i.removeAttribute("style"),this._child.removeAttribute("style"),M(this._visibiliyQueue,!0,this),y(i,e.positioningClass),y(i,e.draggingClass),y(i,e.releasingClass),y(i,e.itemClass),y(i,e.shownClass),y(i,e.hiddenClass),n>-1&&this._muuri._items.splice(n,1),t&&i.parentNode.removeChild(i);for(var r=Object.keys(this).concat(Object.keys(s.Item.prototype)),o=0;o<r.length;o++)this[r[o]]=null},s.Layout=function(t,e){var i=t._settings.layout;if(this.muuri=t,this.items=e?e.concat():t.get("active"),this.slots={},this.width=0,this.height=0,this.setWidth=!1,this.setHeight=!1,this.width=w(t._element,"width"),this.height=w(t._element,"height"),"function"==typeof i)i.call(this);else{var n="string"==typeof i,r=n?i:i[0],o=n?{horizontal:!1,alignRight:!1,alignBottom:!1,forceOrder:!1}:i[1];if("function"!=typeof s.Layout.methods[r])throw new Error('Layout method "'+method+'" does not exist.');typeof s.Layout.methods[r].call(this,o)}},s.Layout.methods={firstFit:function(t){var e=[],i=!!t.forceOrder,n=!!t.horizontal,r=!!t.alignRight,o=!!t.alignBottom;if(this.width=Math.round(this.width),this.height=Math.round(this.height),n?(this.setWidth=!0,this.width=0):(this.setHeight=!0,this.height=0),this.items.length){for(var s=0;s<this.items.length;s++){var a=this.items[s],h=this._getfirstFitSlot(e,a._width,a._height,!n,i);n?this.width=Math.max(this.width,h.left+h.width):this.height=Math.max(this.height,h.top+h.height),this.slots[a._id]=h}if(r||o)for(var l in this.slots){var h=this.slots[l];r&&(h.left=this.width-(h.left+h.width)),o&&(h.top=this.height-(h.top+h.height))}}}},s.Layout.prototype._getfirstFitSlot=function(t,e,i,n,r){var o,s,a,h,l,u=t[0]||[],f=[],m={left:null,top:null,width:e,height:i};for(o=0;o<u.length;o++)if(a=u[o],m.width<=a.width&&m.height<=a.height){m.left=a.left,m.top=a.top;break}for(null===m.left&&(m.left=n?0:this.width,m.top=n?this.height:0,r&&(l=!0)),n&&m.top+m.height>this.height&&(m.left>0&&(f[f.length]={left:0,top:this.height,width:m.left,height:1/0}),m.left+m.width<this.width&&(f[f.length]={left:m.left+m.width,top:this.height,width:this.width-m.left-m.width,height:1/0}),this.height=m.top+m.height),!n&&m.left+m.width>this.width&&(m.top>0&&(f[f.length]={left:this.width,top:0,width:1/0,height:m.top}),m.top+m.height<this.height&&(f[f.length]={left:this.width,top:m.top+m.height,width:1/0,height:this.height-m.top-m.height}),this.width=m.left+m.width),o=r?l?u.length:o:0;o<u.length;o++)for(h=H(u[o],m),s=0;s<h.length;s++)a=h[s],a.width>0&&a.height>0&&(n&&a.top<this.height||!n&&a.left<this.width)&&(f[f.length]=a);return P(f).sort(n?Q:k),t[0]=f,m},s.defaultSettings={container:null,items:[],positionDuration:300,positionEasing:"ease-out",show:{duration:300,easing:"ease-out"},hide:{duration:300,easing:"ease-out"},layout:"firstFit",layoutOnResize:100,layoutOnInit:!0,dragEnabled:!1,dragContainer:document.body,dragPredicate:null,dragSort:!0,dragSortInterval:50,dragSortTolerance:50,dragSortAction:"move",dragReleaseDuration:300,dragReleaseEasing:"ease-out",containerClass:"muuri",itemClass:"muuri-item",shownClass:"muuri-shown",hiddenClass:"muuri-hidden",positioningClass:"muuri-positioning",draggingClass:"muuri-dragging",releasingClass:"muuri-releasing"},s});